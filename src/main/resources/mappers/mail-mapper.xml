<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="mailMapper">

	<resultMap id="MailResult" type="Mail">
		<id column="recep_mail_no" property="recMailNo" />
		<result column="mail_no" property="mailNo" />
		<result column="ref_no" property="refNo" />
		<result column="tag_no" property="tagNo" />
		<result column="tag_name" property="tagName" />
		<result column="tag_color" property="tagColor" />
		<result column="recep_mail_address" property="recMailAdd" />
		<result column="send_mail_address" property="sendMailAdd" />
		<result column="rec_name" property="recName" />
		<result column="send_name" property="sendName" />
		<result column="mail_title" property="mailTitle" />
		<result column="mail_content" property="mailContent" />
		<result column="rec_check" property="recCheck" />
		<result column="rec_date" property="recDate" />
		<result column="date_day" property="dateDay" />
		<result column="date_time" property="dateTime" />
		<result column="impor_mail" property="imporMail" />
		<result column="junk_mail" property="junkMail" />
		<result column="reser_mail" property="reserMail" />
		<result column="status" property="status" />
		<result column="reference" property="reference" />
		<result column="hidden_reference" property="hiddenReference" />
		<result column="sent_date" property="sentDate" />
		<result column="temp_storage" property="tempStorage" />
	</resultMap>

	<resultMap id="TagResult" type="MailTage">
		<id column="tag_no" property="tagNo" />
		<result column="emp_no" property="empNo" />
		<result column="tag_name" property="tagName" />
		<result column="tag_color" property="tagColor" />
	</resultMap> 
	
	<resultMap id="AttachResult" type="Attachment">
		<id column="attach_no" property="attachNo" />
		<result column="ref_no" property="refNo" />
		<result column="origin_name" property="originName" />
		<result column="change_name" property="changeName" />
		<result column="file_path" property="filePath" />
		<result column="upload_date" property="uploadDate" />
		<result column="division" property="division" />
	</resultMap>

	<select id="selectReceiveMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	     where 
			   recep_mail_address = #{ recMailAdd }
		   and r.status = 'Y'
		   and junk_mail = 'N'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectTagList" resultMap="TagResult">
		select
		       tag_no
			 , tag_name
			 , tag_color
		  from mail_tag
		 where emp_no = #{empNo}
		 order
		    by tag_no desc 			 
	</select>

	<insert id="insertTag">
		insert 
		  into mail_tag
	  	  (
	  	    tag_no
	  	  , emp_no
	  	  , tag_name
	  	  , tag_color  
	  	  )
		  values
		  (
		    seq_tagno.nextval
		  , #{empNo}
		  , #{tagName}
		  , #{tagColor}
		  )
	</insert>
	
	<insert id="sendMail">
		insert 
		  into send_mail
		  (
		  	mail_no
		  , send_mail_address
		  , mail_title
		  , mail_content
		  , sent_date
		  , temp_storage
		  )
		  values
		  (
		    seq_mano.nextval
		  , #{ sendMailAdd }
		  , #{ mailTitle }
		  , #{ mailContent }
		  , to_char(sysdate, 'YYYY-MM-DD DY HH24:mi:SS')
		  , #{ tempStorage }
		  )
	</insert>
	
	<insert id="receiveMail">
		insert
		  into rec_mail
		  (
			recep_mail_no
		  , mail_no
		  , recep_mail_address
		  , send_mail_address
		  , mail_title
		  , mail_content
		  , impor_mail
		  , reference
		  , hidden_reference
		  , status
		  )
		  values
		  (
		    seq_recmano.nextval
		  , seq_mano.currval
		  , #{ recMailAdd }
		  , #{ sendMailAdd }
		  , #{ mailTitle }
		  , #{ mailContent }
		  , #{ imporMail }
		  , #{ reference }
		  , #{ hiddenreference }
		  , #{ status }
		  )
	</insert>
	
	<insert id="insertAttachment">
		insert 
		  into attachment
		  (
		    ATTACH_NO
		  , ref_no
	  	  , ORIGIN_NAME
		  , CHANGE_NAME
		  , FILE_PATH
		  , UPLOAD_DATE
		  , DIVISION
		  )
		  values
		  (
		    seq_attno.nextval
		  , seq_mano.currval
		  , #{ originName }
		  , #{ changeName }
		  , #{ filePath }
		  , to_char(sysdate, 'YYYY-MM-DD HH24:mi:SS')
		  , 'M'
		  )
	</insert>
	
	<select id="selectMailAttachment" resultMap="AttachResult">
		select 
			   ATTACH_NO
		     , ref_no
			 , ORIGIN_NAME
			 , FILE_PATH
			 , DIVISION
		 from attachment
		where division = 'M'
		  and ref_no = #{ mailNo }
	</select>
	
	<select id="selectRecSendMailNo" resultType="_int">
		select 
		   	   seq_mano.currval "mail_no"		   	   
		  from 
		       dual
	</select>
	
	<update id="readMail">
		update rec_mail 
		   set rec_check = 'Y'
		     , rec_date = to_char(sysdate, 'YYYY-MM-DD DY HH24:mi:SS')
		 where mail_no = #{ mailNo }
		   and recep_mail_address = #{ recMailAdd }
	</update>
	
	<select id="unReadCount" resultType="_int">
		select count(mail_no)
		  from rec_mail
		 where rec_check = 'N'
		   and recep_mail_address = #{ recMailAdd }
	</select>
	
	<select id="selectMail" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , r.tag_no
			 , e.emp_name "rec_name"
			 , e2.emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = e.email
          join employee e2 on r.send_mail_address = e2.email
     left join mail_tag t on r.tag_no = t.tag_no
	     where 
			   recep_mail_no = #{ recMailNo }
	</select>
	
	<select id="selectTempMail" resultMap="MailResult">
		select
			   mail_no
			 , send_mail_address
			 , mail_title
			 , mail_content
			 , sent_date
			 , status
			 , temp_storage
	      from send_mail 
	     where 
			   mail_no = #{ mailNo }
           and temp_storage = 'Y'
	     order
	        by mail_no DESC
	</select>
	
	<select id="selectReceiverList" resultMap="MailResult">
		select
			   recep_mail_no
			 , mail_no
			 , e.emp_name "rec_name"
			 , e2.emp_name "send_name"
			 , recep_mail_address
			 , send_mail_address
			 , reference
			 , hidden_reference
	      from rec_mail r
	      join employee e on r.recep_mail_address = e.email
	      join employee e2 on r.send_mail_address = e2.email
	     where 
			   mail_no = #{ mailNo }
	</select>
	
	<update id="updateReadUnreadMail">
		update rec_mail
		   set 
  	   		   rec_check = #{ recCheck }
  	   		 , rec_date = case
  	   		   when rec_check = 'Y' then null
               when rec_check = 'N' then to_char(sysdate, 'YYYY-MM-DD HH24:mi:SS')
  	   		   else rec_date
  	   		   end
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<update id="deleteMail">
		update rec_mail
		   set 
		       status = 'N'
		     , junk_mail = 'N'
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<delete id="completeDeleteMail">
		delete 
		  from rec_mail
		 where 
	 	       recep_mail_no = #{ recMailNo }
	</delete>
	
	<update id="spamEnroll">
		update rec_mail
		   set
		       junk_mail = 'Y'
		     , status = 'Y'
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<update id="spamClear">
		update rec_mail
		   set
		       junk_mail = 'N'
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<update id="tagMail">
		update rec_mail
		   set 
		       tag_no = #{ tagNo }
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<select id="selectSpamMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	     where 
			   recep_mail_address = #{ recMailAdd }
		   and r.status = 'Y'
           and junk_mail = 'Y'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectTodayMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	inner join (select to_char(to_date(sysdate), 'YYYY-MM-DD') as selectDate  from dual) e
     		on s.sent_date like '%' || e.selectDate || '%'
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectToMeMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	     where 
			   recep_mail_address = #{recMailAdd}
		   and s.send_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectAttachMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	      join (select distinct ref_no, division from attachment) a on s.mail_no = a.ref_no
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
           and division = 'M'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectImporMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   and impor_mail = 'Y'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectUnreadMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   and rec_check = 'N'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectSendMailList" resultMap="MailResult">
			select
			       recep_mail_no
				 , s.mail_no
	             , ref_no
				 , tag_no
				 , e.emp_name "rec_name"
				 , e2.emp_name "send_name"
				 , r.recep_mail_address
				 , r.send_mail_address
				 , s.mail_title
				 , s.mail_content
				 , rec_check
				 , rec_date
				 , sent_date
				 , impor_mail
				 , junk_mail
				 , reser_mail
				 , r.status
				 , reference
				 , hidden_reference
		      from send_mail s
	          join rec_mail r on s.mail_no = r.mail_no
	          join employee e on r.recep_mail_address = e.email
	          join employee e2 on r.send_mail_address = e2.email	
   full outer join (select distinct ref_no 
                      from attachment) a on s.mail_no = a.ref_no
		     where 
				   s.send_mail_address = #{sendMailAdd}
			   and r.status = 'Y'
	           and s.status = 'Y'
		     order
		        by recep_mail_no ${ sort }
	</select>
	
	<update id="deleteSendMail">
		update send_mail
		   set status = 'N'
		 where mail_no = #{mailNo}
	</update>
	
	<select id="selectTempMailList" resultMap="MailResult">
		select
			   mail_no
			 , send_mail_address
			 , mail_title
			 , mail_content
			 , sent_date
			 , status
			 , temp_storage
	      from send_mail 
	     where 
			   send_mail_address = #{ sendMailAdd }
           and temp_storage = 'Y'
	     order
	        by mail_no ${ sort }
	</select>
	
	<update id="enrollImporMail">
		update rec_mail
		   set impor_mail = #{ imporMail }
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<insert id="enrollFavorMailBox">
		insert 
		  into mail_fav
		  (
	        FAV_NO
		  , EMP_NO
		  , FAV_ORDER
	      , MAILBOX_NAME
		  )
		  values
		  (
		    seq_favno.nextval
		  , #{ empNo }
		  , (select count(fav_no)
		  	   from mail_fav
		  	  where emp_no = #{ empNo })
		  , #{ mailBoxName }
		  )
	</insert>
	
	<delete id="deleteFavorMailBox">
		delete
		  from mail_fav
		 where emp_no = #{ empNo }
		   and mailbox_name = #{ mailBoxName }
	</delete>
	
	<select id="selectTaggingMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , t.tag_no
             , tag_name
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , rec_date
			 , sent_date
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from rec_mail r
          join send_mail s on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
          join mail_tag t on t.tag_no = r.tag_no 
	     where 
			   t.tag_no = #{ tagNo }
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<select id="selectTag" resultMap="TagResult">
		select
		       tag_no
			 , EMP_NO
			 , tag_name
			 , tag_color
		  from mail_tag
		 where tag_no = #{ tagNo }
	</select>
	
	<select id="selectDeleteMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	     where 
			   recep_mail_address = #{ recMailAdd }
		   and r.status = 'N'
	     order
	        by recep_mail_no ${ sort }
	</select>
	
	<update id="restoreDeleteMail">
		update rec_mail
		   set
		       status = 'Y'
		 where recep_mail_no = #{ recMailNo }
	</update>
	
	<delete id="completeDeleteMailAll1">
		delete 
		  from rec_mail
		 where 
		   	   recep_mail_address = #{ email }
		   and status = 'N'
	</delete>
	
	<delete id="completeDeleteMailAll2">
		delete 
		  from rec_mail
		 where 
		   	   recep_mail_address = #{ email }
		   and junk_mail = 'Y'
	</delete>
	
	<insert id="insertTempMail">
		insert 
		  into send_mail
		  (
		  	mail_no
		  ,	send_mail_address
		  ,	sent_date
		  ,	mail_title
	      ,	mail_content
		  ,	temp_storage
		  )
		  values
		  (
		    seq_mano.nextval
		  , #{ sendMailAdd }
		  , to_char(sysdate, 'YYYY-MM-DD DY HH24:mi:SS')
		  , #{ mailTitle }
		  , #{ mailContent }
		  , 'Y'
		  )
	</insert>
	
	<select id="searchReceiveMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	     where 
			   recep_mail_address = #{ recMailAdd }
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchImporMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   and impor_mail = 'Y'
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchAttachMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	      join (select distinct ref_no, division from attachment) a on s.mail_no = a.ref_no
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
           and division = 'M'
           <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchTodayMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	inner join (select to_char(to_date(sysdate), 'YYYY-MM-DD') as selectDate  from dual) e
     		on s.sent_date like '%' || e.selectDate || '%'
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchToMeMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	     where 
			   recep_mail_address = #{recMailAdd}
		   and s.send_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchUnreadMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
	     where 
			   recep_mail_address = #{recMailAdd}
		   and r.status = 'Y'
		   and junk_mail = 'N'
		   and rec_check = 'N'
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchTempMailList" resultMap="MailResult">
		select
			   mail_no
			 , send_mail_address
			 , mail_title
			 , mail_content
			 , sent_date
			 , status
	      from send_mail 
	     where 
			   send_mail_address = #{ sendMailAdd }
           and temp_storage = 'Y'
           <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by mail_no DESC
	</select>
	
	<select id="searchSendMailList" resultMap="MailResult">
		select
			       recep_mail_no
				 , s.mail_no
	             , ref_no
				 , tag_no
				 , e.emp_name "rec_name"
				 , e2.emp_name "send_name"
				 , r.recep_mail_address
				 , r.send_mail_address
				 , s.mail_title
				 , s.mail_content
				 , rec_check
				 , rec_date
				 , sent_date
				 , impor_mail
				 , junk_mail
				 , reser_mail
				 , r.status
				 , reference
				 , hidden_reference
		      from send_mail s
	          join rec_mail r on s.mail_no = r.mail_no
	          join employee e on r.recep_mail_address = e.email
	          join employee e2 on r.send_mail_address = e2.email	
   full outer join (select distinct ref_no 
                      from attachment) a on s.mail_no = a.ref_no
		     where 
				   s.send_mail_address = #{sendMailAdd}
			   and r.status = 'Y'
	           and s.status = 'Y'
	           <choose>
			    	<when test="category == 'all'">
				    	and (r.send_mail_address like '%'||#{keyword}||'%'
				        	 or e.emp_name like '%'||#{keyword}||'%'
		            		 or r.mail_title like '%'||#{keyword}||'%'
		            		 or r.mail_content like '%'||#{keyword}||'%')
			    	</when>
			    	<when test="category == 'name'">
			    		and e.emp_name like '%'||#{keyword}||'%'
			    	</when>
			    	<when test="category == 'address'">
			    		and r.send_mail_address like '%'||#{keyword}||'%'
			    	</when>
			    	<when test="category == 'title'">
			    		and r.mail_title like '%'||#{keyword}||'%'
			    	</when>
			    	<when test="category == 'content'">
			    		and r.mail_content like '%'||#{keyword}||'%'
			    	</when>
			   </choose>
		     order
		        by recep_mail_no DESC
	</select>
	
	<select id="searchDeleteMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	     where 
			   recep_mail_address = #{ recMailAdd }
		   and r.status = 'N'
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchSpamMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , tag_no
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , sent_date
			 , substr(sent_date, 0, 11) "date_day"
             , substr(sent_date, 14) "date_time"
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from send_mail s
          join rec_mail r on s.mail_no = r.mail_no
          join employee e on r.send_mail_address = email
	     where 
			   recep_mail_address = #{ recMailAdd }
		   and r.status = 'Y'
           and junk_mail = 'Y'
           <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
	
	<select id="searchTaggingMailList" resultMap="MailResult">
		select
		       recep_mail_no
			 , s.mail_no
			 , t.tag_no
             , tag_name
			 , emp_name "send_name"
			 , r.recep_mail_address
			 , r.send_mail_address
			 , s.mail_title
			 , s.mail_content
			 , rec_check
			 , rec_date
			 , sent_date
			 , impor_mail
			 , junk_mail
			 , reser_mail
			 , r.status
			 , reference
			 , hidden_reference
	      from rec_mail r
          join send_mail s on s.mail_no = r.mail_no
          join employee e on r.recep_mail_address = email
          join mail_tag t on t.tag_no = r.tag_no 
	     where 
			   t.tag_no = #{ tagNo }
		   <choose>
		    	<when test="category == 'all'">
			    	and (r.send_mail_address like '%'||#{keyword}||'%'
			        	 or emp_name like '%'||#{keyword}||'%'
	            		 or r.mail_title like '%'||#{keyword}||'%'
	            		 or r.mail_content like '%'||#{keyword}||'%')
		    	</when>
		    	<when test="category == 'name'">
		    		and emp_name like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'address'">
		    		and r.send_mail_address like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'title'">
		    		and r.mail_title like '%'||#{keyword}||'%'
		    	</when>
		    	<when test="category == 'content'">
		    		and r.mail_content like '%'||#{keyword}||'%'
		    	</when>
		   </choose>
	     order
	        by recep_mail_no DESC
	</select>
</mapper>